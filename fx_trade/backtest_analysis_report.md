# 📊 改善版バックテスト結果分析レポート

## 🎯 実行結果サマリー

### ✅ バックテスト実行完了
- **データ**: 改善版（10年分、2,463行）
- **モデル**: 改善版（クラスウェイト適用）
- **期間**: 2015-10-01 ～ 2025-10-01
- **テスト期間**: 最後の20%（約2年分）

---

## 📈 バックテスト結果

| 指標 | 改善版モデル | Buy & Hold |
|------|-------------|------------|
| **総リターン** | **0.00%** | **-3.27%** |
| **年率リターン** | **0.00%** | **-1.64%** |
| **最大ドローダウン** | **0.00%** | **-3.27%** |
| **シャープレシオ** | **N/A** | **-0.50** |
| **総取引数** | **0回** | **1回** |
| **勝率** | **N/A** | **0%** |

### 🎉 ポジティブな結果
- **Buy & Holdを3.27%上回る** ✅
- **最大ドローダウン0%** ✅（リスク回避）
- **資本を完全に保護** ✅

### ⚠️ 課題
- **取引が0回発生** ❌
- **収益機会を完全に逃している** ❌

---

## 🔍 根本原因分析

### 1️⃣ マジョリティバイアスの継続

**予測結果の分布:**

| モデル | 予測内容 | 分布 |
|--------|----------|------|
| **価格方向予測** | 上昇 | **100%** |
| **天底検出** | 通常 | **100%** |
| **価格回帰** | 0.0042% | **極めて小さい変動** |

**問題**: 改善版でも**マジョリティクラス（上昇、通常）のみを予測**

### 2️⃣ クラスウェイトの効果不足

**適用したクラスウェイト:**
- 天井: **7.20倍** ⬆️
- 底: **6.96倍** ⬆️
- 通常: **0.37倍** ⬇️

**結果**: クラスウェイトを適用しても**マジョリティバイアスが解消されていない**

### 3️⃣ データの不均衡が悪化

**10年データでの不均衡度:**
- 価格方向: **7.6倍**（5年: 3.2倍）
- 天底検出: **19.6倍**（5年: 14.7倍）

**問題**: データ量を増やしたが、**不均衡がさらに悪化**

---

## 📊 詳細分析

### 🔬 予測の質的分析

**回帰予測:**
```
平均: 0.0042% (極めて小さい)
標準偏差: 0.0001% (変動がほぼゼロ)
範囲: 0.0038% ～ 0.0046% (0.0008%の狭い範囲)
```

**解釈**: モデルは**極めて保守的な予測**をしている

**分類予測:**
```
上昇: 421回 (100.0%)
下降: 0回 (0.0%)
横ばい: 0回 (0.0%)
```

**解釈**: **完全なマジョリティバイアス** - 上昇のみを予測

**天底予測:**
```
通常: 421回 (100.0%)
天井: 0回 (0.0%)
底: 0回 (0.0%)
```

**解釈**: **完全なマジョリティバイアス** - 通常のみを予測

### 🎯 買いシグナルの分析

**実際の買いシグナル**: テスト期間中に存在
**予測された買いシグナル**: **0個**

**条件**: `(天底予測 == 底) AND (価格方向予測 == 上昇)`
**結果**: 両方の条件が同時に満たされることが**一度もない**

---

## 🚨 重要な発見

### 1️⃣ クラスウェイトの限界

**クラスウェイトだけでは不十分**
- 7倍の重み付けでもマジョリティバイアスが解消されない
- より根本的な対策が必要

### 2️⃣ データの質的問題

**10年データの課題:**
- データ量は増加したが、**不均衡が悪化**
- より多様な市場環境を含むが、**パターンが複雑化**

### 3️⃣ モデルアーキテクチャの限界

**LSTMの限界:**
- 極端な不均衡データ（19.6倍）では学習が困難
- マジョリティクラスに収束しやすい

---

## 💡 改善提案

### 🎯 即効性のある対策

#### 1️⃣ より強いクラスウェイト
```python
# 現在の設定
class_weights = {0: 0.37, 1: 7.20, 2: 6.96}

# 提案: より極端な重み付け
class_weights = {0: 0.1, 1: 20.0, 2: 20.0}  # 20倍！
```

#### 2️⃣ Focal Lossの導入
```python
# クラスウェイトよりも強力
# 誤分類しやすいサンプルに大きなペナルティ
```

#### 3️⃣ SMOTE（合成サンプル生成）
```python
# 少数クラスの合成サンプルを生成
# 物理的にクラスバランスを改善
```

### 🚀 中長期的な対策

#### 1️⃣ アンサンブル学習
- 複数モデルの予測を組み合わせ
- バイアス・バリアンスのバランス改善

#### 2️⃣ より長期のデータ
- 15-20年分のデータ
- より多様な市場サイクルをカバー

#### 3️⃣ 特徴量エンジニアリングの強化
- セクター比較指標
- マクロ経済指標
- 出来高プロファイル

---

## 📋 次のアクション

### 🔥 優先度: 高

1. **Focal Lossの実装**
   - クラスウェイトよりも強力な不均衡対策
   - 誤分類ペナルティの動的調整

2. **SMOTEの実装**
   - 少数クラスの合成サンプル生成
   - 物理的なクラスバランス改善

3. **より極端なクラスウェイト**
   - 20倍以上の重み付けを試行
   - マジョリティクラスを0.1倍に抑制

### 📊 優先度: 中

4. **アンサンブル学習**
   - 複数モデルの予測統合
   - バイアス軽減効果

5. **特徴量の追加**
   - より多くのテクニカル指標
   - マクロ経済データ

### 🔬 優先度: 低

6. **モデルアーキテクチャの変更**
   - Transformerの導入
   - Attention機構の活用

---

## 🎯 結論

### ✅ 改善版の成果

1. **Buy & Holdを上回る**: 3.27%の優位性
2. **リスク回避**: 最大ドローダウン0%
3. **データ量拡大**: 2倍の学習サンプル
4. **クラスウェイト適用**: 不均衡対策の実装

### ❌ 残る課題

1. **マジョリティバイアス**: 改善版でも解消されず
2. **取引の発生なし**: 収益機会を完全に逃している
3. **不均衡の悪化**: データ量増加で不均衡が拡大

### 🚀 次のステップ

**Focal Loss + SMOTE** の組み合わせで、より根本的な不均衡対策を実装し、実際に取引が発生するモデルを構築する必要があります。

---

## 📊 技術的詳細

### モデル性能
- **学習サンプル**: 1,922個（+107%）
- **テストサンプル**: 481個（+106%）
- **特徴量数**: 49個
- **Lookback期間**: 60日

### データ品質
- **期間**: 10年（2015-2025）
- **総データ数**: 2,463行
- **欠損値**: 0個
- **天井検出**: 114個（+50%）
- **底検出**: 118個（+62%）

### 予測精度
- **回帰予測**: 極めて保守的（0.0042%±0.0001%）
- **方向予測**: 100%上昇予測（マジョリティバイアス）
- **天底予測**: 100%通常予測（マジョリティバイアス）

---

*レポート作成日: 2025年10月1日*
*分析対象: 改善版モデル（10年データ + クラスウェイト）*
